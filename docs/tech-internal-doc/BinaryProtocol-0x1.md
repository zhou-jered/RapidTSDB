# 概述

客户端在连接上服务端之后需求提交认证信息，
认证完成之后，连接处于可读/可写，可读写状态。

网络连接在任意时刻会处于以下状态：
每种状态对应一种子协议
- 连接配置协商状态：
    协商内容包括：
        - 连接类型：长连接/短连接
        - 下一步子协议（认证/读写/导入/管理/）
        - 下一步协议的版本
        - 其他内容
    
    客户端首先发送 magic number 使连接进入 rpc 模式。
    接下来客户端发送协商消息：
    ｜客户端版本｜客户端支持最大版本｜客户端支持最小版本｜客户端优先选择版本｜
    
    服务端应答：
    ｜应答码｜协议版本｜
    
    
    
    
- 认证状态
    - 如果协商过程要求认证，则进入认证状态
    - 
    
- 读写协议


- 导入数据协议


- 管理协议（内部）
    - 
    
    

## 消息格式

### 连接配置协商消息
| magic number 4 bytes |

### 认证消息格式
| 消息体对象code 2 byte  |
| 消息体长度 2 bytes     |
| 消息体 bytes (认证对象）|

 

## 版本 1.0.0 0x1
客户端与服务端建立连接之后，连接会处于以下状态

|状态|说明|||
|-|-|-|-|
|等待认证|连接创建初始状态|||
|认证中|提交认证信息|||
|可读写|读写数据交互|||

## 响应码表 （2字节）
|响应码|说明|
|-|-|
|0x0| 操作成功|
|0x1|正常，服务端等待客户端数据|
|0xa0|认证错误|
|0xa1|操作无权限|
|0x30|服务端拒绝处理|
|0x31|不支持的downsampler|
|0x32|不支持的aggregator|
|0xee|服务端内部错误|
|0x90|客户端版本过低|
|0x91|客户端版本过高|
|0xff|协议出错|
|0xee|断开连接，byebye|
|0xfe|服务器关机|


